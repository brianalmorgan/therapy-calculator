<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Therapy Calculator</title>
  <meta name="description" content="Therapy Calculator">
  <meta name="author" content="Lauren Hallden">

  <!-- Form css -->
  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/app.css">

  <link rel="stylesheet" href="stylesheets/screen.css">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <div class="container">
  <div class="intro">
    <h1>How much can I expect to pay for therapy?</h1>
    <p class="subhead">*in 2017 America</p>
  </div>

    <section id="section-1">
      <h2>Hey! I’m glad you’re here.</h2>
      <p>I know the idea of budgeting for therapy is stressful, but it may not cost as much as you think. I’ll try to get you some answers.</p>
      <p>
        <div class="disclaimer">
          <strong>A small disclaimer:</strong> I’m not a tax or insurance professional. I’m just <a href="http://www.laurenhallden.com">a web designer</a> who thinks this process should be less scary. Please consult an expert before making decisions that impact your finances and health.
        </div>
      </p>
      <p>The first question is an awkward one (sorry!): how much money does your household make in a year?</p>
      <form id="form-1" class="section-form" data-abide novalidate>
        <label><span>Your household income:</span>
          <input id="income-field" type="text" aria-describedby="exampleHelpText" required pattern="number">
          <span class="form-error">
            Enter a number.
          </span>
        </label>
        <p class="help-text"> I won’t share it with anyone, don’t worry. I just need to do some math. But you can also <a href="">see a demo</a> with sample numbers.</p>
        <button class="button next-step">Next step</button>
      </form>
    </section>

    <!-- Your per session rate -->
    <section id="section-2" class="hidden">
      <div id="sliding-scale-div"><h2>Your per-session rate:</h2></div>
      <p>I’d estimate that each session might cost you <span class="strong">$</span><span class="strong" id="baserate-span"></span>. But if you already have someone in mind and you know what they charge, you can adjust your rate.</p>
      <div class="col col-8 middle">
        <label>Set your rate to:</label>
        <div class="slider" data-slider data-options="start: 20; end: 150; step: 5;">
          <span class="slider-handle"  data-slider-handle role="slider" tabindex="1" aria-controls="sliderOutput1"></span>
          <span class="slider-fill" data-slider-fill></span>
        </div>
      </div>
      <div class="col col-4 middle padded-top">
        <input type="number" id="sliderOutput1">
      </div>

      <div id="accordion"></div>

      <p>If you see your therapist once a week, that’s <span class="strong">$</span><span class="strong" id="yearly-cost-span"></span> over the course of a year.</p>
      <p>But don’t worry just yet&mdash;let’s see if we can lower that. Do you have health insurance? Some therapists don't accept it, but you may still be able to get some money back.</p>
      <a class="button next-step" href="#section-3" id="step-two-yes">Yes, let’s check</a>
      <a class="button next-step outline" href="#section-6" id="step-two-no">Nope, no insurance</a>
    </section>

    <!-- Getting your health insurance -->
    <section id="section-3" class="hidden">
      <h2>Great! Now for the tricky part:</h2>
      <p>We’re gonna need some details on your plan’s mental health benefits. You can check online, or call your insurance company’s help line to have a real person explain everything. You’ll want to know:</p>
      <ul>
        <li>Is therapy delivered in an office setting covered by your plan?</li>
        <li>If your plan has a preferred network, what's your <strong>copayment</strong> for an in-network provider?</li>
        <li>What is the <strong>coinsurance rate</strong> for an out-of-network provider?</li>
        <li>What is your current <strong>deductible</strong>?</li>
      </ul>
      <p>When you’re ready, let’s walk through the options.</p>
      <form>
        <label><span>Your therapy appointments are:</span>
          <select id="covered-or-not">
            <option value="covered">Covered or partially covered</option>
            <option value="not-covered">Not covered</option>
          </select>
        </label>
        <label id="network-or-not-label"><span>And your therapist is:</span>
          <select id="network-or-not">
            <option value="in-network">In-network</option>
            <option value="out-of-network">Out-of-network</option>
          </select>
        </label>
        <a class="button next-step" id="step-three">Next step</a>
      </form>
    </section>

    <!-- Getting your in-network benefits -->
    <section id="section-4" class="hidden">
      <h2>Nice!</h2>
      <p>Let’s apply your insurance and see if that lowers your costs.</p>
      <form>
        <label><span>Your copay for therapy:</span>
          <input type="text" id="copay-field">
        </label>
        <p class="help-text">This is probably the same as what you’d pay to see a specialist.</p>
        <label><span>Your deductible:</span>
          <input type="text" id="deductible-field-innetwork">
        </label>
        <p class="help-text">You may not have one, but if you do, enter it here.</p>
        <a class="button next-step" id="step-four">Apply it!</a>
      </form>
    </section>

    <!-- Getting your out-of-network benefits -->
    <section id="section-5" class="hidden">
      <h2>Not a problem.</h2>
      <p>The coverage you have may still be helpful. Let’s check. I entered some example amounts here for you, but you should adjust them.</p>
      <form>
        <label><span>Your deductible:</span>
          <input type="text" id="deductible-field-outofnetwork" value="1000">
        </label>
        <p class="help-text">You can enter your yearly deducible. (Or if you know you don’t typically reach it in a year, you can enter the amount you don’t use up.)</p>
        <label><span>Your coinsurance rate:</span>
          <input type="text" id="coinsurance-field" value="30">
        </label>
        <p class="help-text">Enter the percentage you are responsible for. For example, after you hit your deductible, your insurance may cover 70% of your costs, so your coinsurance rate is 30%</p>
        <a class="button next-step" id="step-five">Looks good!</a>
      </form>
    </section>

    <!-- Applying your health insurance -->
    <section id="section-6" class="hidden">
      <div class="variable-content">
        <h2>Okay! Let’s try something else.</h2>
        <p id="insurance-results">That brought your cost down to <span class="strong">$</span><span class="strong" id="insurance-yearly-span"></span> per year, or about <span class="strong">$</span><span class="strong" id="insurance-baserate-span"></span> per session averaged out. Getting less scary already.</p>
      </div>
      <p>There’s another thing to check: <strong>tax deductions</strong>.</p>
      <p>I know, thinking about taxes is kinda terrible. But deductions can help! Taxes come into play if you’re eligible for a <a target="_blank" href="https://www.healthcare.gov/have-job-based-coverage/flexible-spending-accounts/">Flexible Spending Account</a> (FSA) or a <a target="_blank" href="https://www.healthcare.gov/glossary/health-savings-account-HSA">Health Savings Account</a> (HSA). You <em>may</em> even be able to deduct your therapy bills directly.</p>
      <form>
        <label><span>Let’s see what happens if you have:</span>
          <select id="tax-vehicle">
            <option value="fsa">A Flexbile Spending Account</option>
            <option value="hsa">A Health Savings Account</option>
            <option value="no-tax-vehicle">Neither</option>
          </select>
        </label>
        <a class="button next-step" id="step-six-yes">Check deductions</a>
        <a class ="button next-step outline" id="step-six-no" href="#section-9">Nope, skip the taxes stuff</a>
      </form>
    </section>

    <!-- Getting your FSA contribution -->
    <section id="section-7" class="hidden">
      <h2>Set your FSA contribution.</h2>
      <p>The more you contribute here, the more you can lower your tax burden. But the maximum allowed <strong>$2,600</strong>.</p>
      <p>If you’re already contributing, you may not have enough room left to add the full amount of therapy to your FSA. In that case, take the maximum if you can.</p>
      <p>Otherwise, let’s assume you can put <input type="number" id="fsa-field" value=""></span> in your FSA, and see how much that lowers your costs.</p>
      <!-- Would be nice to set a max limit here -->
      <a class="button next-step" id="step-seven-yes">Check it out</a>
      <a class="button next-step outline" id="step-seven-no">Skip it</a>
    </section>

    <!-- Getting your FSA contribution -->
    <section id="section-8" class="hidden">
      <h2>Set your HSA contribution.</h2>
      <p>I need to research this.</p>
    </section>

    <!-- Getting your FSA contribution -->
    <section id="section-9" class="hidden">
      <h2>Itemized deductions.</h2>
      <p>I need to research this.</p>
    </section>

    <!-- Applying your tax contributions -->
    <section id="section-10" class="hidden">
      <h2>Guess what?</h2>
      <p>I think you can save <span class="strong">$</span><span class="strong" id="tax-discount-span"></span> on your taxes.</p>
      <p>Let's get you a sumary of all my recommendations:</p>
      <a class="button next-step" id="final-step">Get your final summary</a>
    </section>

    <section id="section-11" class="hidden">
      <h2>We’re all done.</h2>
      <p>Here are my final estimations:</p>
      <p>Your session rate: <span id="final-session-rate"></span></p>
      <p>A year of therapy might cost you <span id="final-yearly-cost"></span>, but you’ll have saved <span id="insurance-saved"></span> by using your insurance and <span id="taxes-saved"></span> on your taxes by using your FSA.</p>
    </section>

    <div class="footer">
      <p>Want to help make this better?</p>
      <p><a href="https://github.com/laurenhallden/therapy-calculator">Contribute on GitHub</a></p>
    </div>


  </div> <!-- End container -->
	<!-- JS -->
    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script src="js/app.js"></script>
    <script src="js/vendor/smooth-scroll.js"></script>
  <script src="js/scripts.js"></script>

  <!-- All our button functions -->
  <script>
    // Start with the assumption that we see a therapist once a week;
    // 48 times a year
    $( document ).ready(function(){
        window.globalNumberOfSessions = 48;
    });

    // Stop forms from posting on form submit
    $(".section-form").on("valid invalid submit", function(e){
      e.stopPropagation();
      e.preventDefault();
    });

    // Calculate baserate
    $("#form-1").on('formvalid.zf.abide', function(e){
      var income = $.trim($("#income-field").val());
      window.globalIncome = income;
      stepOne(income);
      console.log("income:" + income);
    });

    // Update baserate based on slider
    $('.slider').on('changed.zf.slider', function(){
      var yearlyCostValue = $.trim($('#yearly-cost-span').html());
      if (yearlyCostValue =='') {
      }
      else {
        var currentSliderValue = $('#sliderOutput1').val();
        var updatedYearlyCost = currentSliderValue*globalNumberOfSessions;
        $('#yearly-cost-span').html(updatedYearlyCost);
      }
    });

    // Check insurance
    $("#step-three").click(function(){
      var coveredYesNo = $('#covered-or-not :selected').val();
      var networkYesNo = $('#network-or-not :selected').val();
      checkInsurance(coveredYesNo, networkYesNo);
    });

    // Apply in-network insurance
    $("#step-four").click(function(){
      var copay = $.trim($("#copay-field").val());
      copay = parseInt(copay,10);
      console.log(copay);
      var deductible = $.trim($("#deductible-field-innetwork").val());
      deductible = parseInt(deductible,10);
      applyNetworkInsurance(copay,deductible);
    });

    // Apply out-of-network insurance
    $("#step-five").click(function(){
      var deductible = $.trim($("#deductible-field-outofnetwork").val());
      deductible = parseInt(deductible,10);
      console.log(deductible);
      var coinsurance = $.trim($("#coinsurance-field").val());
      coinsurance = parseInt(coinsurance,10);
      applyInsurance(deductible,coinsurance);
    });

    // Check FSA or HSA...
    $("#step-six-yes").click(function(){
      var taxVehicle = $('#tax-vehicle :selected').val();
      if ( taxVehicle == "fsa") {
        setFSA();
      }
      else if ( taxVehicle == "hsa") {
        setHSA();
      }
      else {
        var location = "#section-9";
        scrollTo(location);
      }
    });

    // ...or skip taxes section completely.
    $("#step-six-no").click(function(){
      getSummary();
    });

    // Set FSA
    $("#step-seven-yes").click(function(){
      var fsaAmount = $("#fsa-field").val();
      getFSA(fsaAmount);
    });

    // Get final summary!
    $("#final-step").click(function(){getSummary()});

  </script>
</body>
</html>